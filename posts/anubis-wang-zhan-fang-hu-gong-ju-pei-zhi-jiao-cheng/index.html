<!DOCTYPE html><html lang="zh-CN"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="icon" href="/favicon.ico"><!-- L'Internationale, 
  Sera le genre humain. --><title>Anubis网站防护工具配置教程 - 薇尔薇</title><meta name="author" content="violet"><meta name="description" content="Only the paranoid survive"><meta name="keywords" content="violet,vio.vin,薇尔薇,blog,博客"><meta name="generator" content="Astro v4.16.18"><meta property="og:url" content="https://www.vio.vin/posts/anubis-wang-zhan-fang-hu-gong-ju-pei-zhi-jiao-cheng/"><meta property="og:type" content="website"><meta property="og:title" content="Anubis网站防护工具配置教程"><meta property="og:description" content="Only the paranoid survive"><meta property="twitter:card" content="summary_large_image"><meta property="twitter:title" content="Anubis网站防护工具配置教程"><meta property="twitter:description" content="Only the paranoid survive"><link rel="canonical" href="https://www.vio.vin/posts/anubis-wang-zhan-fang-hu-gong-ju-pei-zhi-jiao-cheng/"><link rel="sitemap" href="/sitemap-index.xml"><link rel="alternate" type="application/rss+xml" title="薇尔薇" href="https://www.vio.vin/rss.xml"><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-STPJCGJ78E"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());

gtag('config', 'G-STPJCGJ78E');</script><script>(function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
          })(window, document, "clarity", "script", "sp1uxmzagn");</script><!-- 防止路由切换时的白屏闪烁 --><!-- 路由切换滚动控制器 --><!-- 代码复制功能处理器 --><link rel="stylesheet" href="/_astro/_page_.BOm8dQKx.css">
<link rel="stylesheet" href="/_astro/_spec_.DvXbAGE-.css">
<link rel="stylesheet" href="/_astro/_spec_.DEnEpXTS.css">
<link rel="stylesheet" href="/_astro/ToastContainer.BE4BdE5o.css"><script type="module" src="/_astro/hoisted.DyiIMSKU.js"></script>
<script type="module" src="/_astro/page.ZZ1UhvcW.js"></script></head> <body>  <style>astro-island,astro-slot,astro-static-slot{display:contents}</style><script>(()=>{var e=async t=>{await(await t())()};(self.Astro||(self.Astro={})).only=e;window.dispatchEvent(new Event("astro:only"));})();;(()=>{var A=Object.defineProperty;var g=(i,o,a)=>o in i?A(i,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):i[o]=a;var d=(i,o,a)=>g(i,typeof o!="symbol"?o+"":o,a);{let i={0:t=>m(t),1:t=>a(t),2:t=>new RegExp(t),3:t=>new Date(t),4:t=>new Map(a(t)),5:t=>new Set(a(t)),6:t=>BigInt(t),7:t=>new URL(t),8:t=>new Uint8Array(t),9:t=>new Uint16Array(t),10:t=>new Uint32Array(t),11:t=>1/0*t},o=t=>{let[l,e]=t;return l in i?i[l](e):void 0},a=t=>t.map(o),m=t=>typeof t!="object"||t===null?t:Object.fromEntries(Object.entries(t).map(([l,e])=>[l,o(e)]));class y extends HTMLElement{constructor(){super(...arguments);d(this,"Component");d(this,"hydrator");d(this,"hydrate",async()=>{var b;if(!this.hydrator||!this.isConnected)return;let e=(b=this.parentElement)==null?void 0:b.closest("astro-island[ssr]");if(e){e.addEventListener("astro:hydrate",this.hydrate,{once:!0});return}let c=this.querySelectorAll("astro-slot"),n={},h=this.querySelectorAll("template[data-astro-template]");for(let r of h){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("data-astro-template")||"default"]=r.innerHTML,r.remove())}for(let r of c){let s=r.closest(this.tagName);s!=null&&s.isSameNode(this)&&(n[r.getAttribute("name")||"default"]=r.innerHTML)}let p;try{p=this.hasAttribute("props")?m(JSON.parse(this.getAttribute("props"))):{}}catch(r){let s=this.getAttribute("component-url")||"<unknown>",v=this.getAttribute("component-export");throw v&&(s+=` (export ${v})`),console.error(`[hydrate] Error parsing props for component ${s}`,this.getAttribute("props"),r),r}let u;await this.hydrator(this)(this.Component,p,n,{client:this.getAttribute("client")}),this.removeAttribute("ssr"),this.dispatchEvent(new CustomEvent("astro:hydrate"))});d(this,"unmount",()=>{this.isConnected||this.dispatchEvent(new CustomEvent("astro:unmount"))})}disconnectedCallback(){document.removeEventListener("astro:after-swap",this.unmount),document.addEventListener("astro:after-swap",this.unmount,{once:!0})}connectedCallback(){if(!this.hasAttribute("await-children")||document.readyState==="interactive"||document.readyState==="complete")this.childrenConnectedCallback();else{let e=()=>{document.removeEventListener("DOMContentLoaded",e),c.disconnect(),this.childrenConnectedCallback()},c=new MutationObserver(()=>{var n;((n=this.lastChild)==null?void 0:n.nodeType)===Node.COMMENT_NODE&&this.lastChild.nodeValue==="astro:end"&&(this.lastChild.remove(),e())});c.observe(this,{childList:!0}),document.addEventListener("DOMContentLoaded",e)}}async childrenConnectedCallback(){let e=this.getAttribute("before-hydration-url");e&&await import(e),this.start()}async start(){let e=JSON.parse(this.getAttribute("opts")),c=this.getAttribute("client");if(Astro[c]===void 0){window.addEventListener(`astro:${c}`,()=>this.start(),{once:!0});return}try{await Astro[c](async()=>{let n=this.getAttribute("renderer-url"),[h,{default:p}]=await Promise.all([import(this.getAttribute("component-url")),n?import(n):()=>()=>{}]),u=this.getAttribute("component-export")||"default";if(!u.includes("."))this.Component=h[u];else{this.Component=h;for(let f of u.split("."))this.Component=this.Component[f]}return this.hydrator=p,this.hydrate},e,this)}catch(n){console.error(`[astro-island] Error hydrating ${this.getAttribute("component-url")}`,n)}}attributeChangedCallback(){this.hydrate()}}d(y,"observedAttributes",["props"]),customElements.get("astro-island")||customElements.define("astro-island",y)}})();</script><astro-island uid="Ss423" component-url="/_astro/Provider.Bkoh_qAY.js" component-export="Provider" renderer-url="/_astro/client.mqtPdmm5.js" props="{&quot;pathName&quot;:[0,&quot;/posts/anubis-wang-zhan-fang-hu-gong-ju-pei-zhi-jiao-cheng/&quot;],&quot;title&quot;:[0,&quot;Anubis网站防护工具配置教程&quot;],&quot;description&quot;:[0,&quot;Article / Anubis&quot;],&quot;slug&quot;:[0,&quot;/posts/anubis-wang-zhan-fang-hu-gong-ju-pei-zhi-jiao-cheng&quot;]}" ssr="" client="only" opts="{&quot;name&quot;:&quot;Provider&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <astro-island uid="20kLSM" component-url="/_astro/Header.CDHryGn1.js" component-export="Header" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;Header&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <main class="relative z-1 pt-16 min-h-main bg-primary"> <script>(()=>{var l=(o,t)=>{let i=async()=>{await(await o())()},e=typeof t.value=="object"?t.value:void 0,s={timeout:e==null?void 0:e.timeout};"requestIdleCallback"in window?window.requestIdleCallback(i,s):setTimeout(i,s.timeout||200)};(self.Astro||(self.Astro={})).idle=l;window.dispatchEvent(new Event("astro:idle"));})();</script><astro-island uid="1Gf5mu" prefix="r5" component-url="/_astro/head-gradient.BgZUKpq1.js" component-export="HeadGradient" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="idle" opts="{&quot;name&quot;:&quot;HeadGradient&quot;,&quot;value&quot;:true}" await-children=""><div class="absolute -z-1 top-0 inset-x-0 h-[350px] bg-gradient-to-r from-accent/5 to-accent/15" style="mask-image:linear-gradient(black, transparent);opacity:0"></div><!--astro:end--></astro-island> <div class="swup-transition-fade">  <div class="max-w-[1100px] mx-auto px-4 md:px-8 py-16 grid lg:grid-cols-[auto_260px] gap-8" data-pagefind-body> <div> <header class="space-y-4"> <h1 class="text-4xl font-bold text-center"> Anubis网站防护工具配置教程 </h1> <div class="flex flex-wrap gap-2 text-sm text-secondary justify-center"> <div> <i class="iconfont icon-calendar"></i> <astro-island uid="OO7uO" prefix="r7" component-url="/_astro/RelativeDate.DIwoSoX4.js" component-export="RelativeDate" renderer-url="/_astro/client.mqtPdmm5.js" props="{&quot;date&quot;:[3,&quot;2025-08-21T19:50:03.000Z&quot;]}" ssr="" client="idle" opts="{&quot;name&quot;:&quot;RelativeDate&quot;,&quot;value&quot;:true}" await-children=""><span>25 年 8 月 22 日 星期五</span><!--astro:end--></astro-island> <span class="text-xs">(已编辑)</span> </div> <div> <i class="iconfont icon-file-list"></i> <span>1702 字</span> </div> <div> <i class="iconfont icon-timer"></i> <span>9 分钟</span> </div> </div> <div class="flex flex-wrap gap-2 text-sm text-secondary justify-center"> <div> <i class="iconfont icon-folder"></i> <a class="hover:text-accent hover:underline underline-offset-2 decoration-dashed" href="/categories/article"> Article </a> </div> <div> <i class="iconfont icon-hashtag"></i> <a class="hover:text-accent hover:underline underline-offset-2 decoration-dashed" href="/tags/anubis"> Anubis </a>  </div> </div> <div> <astro-island uid="ZjWMV1" prefix="r0" component-url="/_astro/Outdate.BbapSqSY.js" component-export="Outdate" renderer-url="/_astro/client.mqtPdmm5.js" props="{&quot;lastMod&quot;:[3,&quot;2025-08-21T19:50:03.000Z&quot;]}" ssr="" client="idle" opts="{&quot;name&quot;:&quot;Outdate&quot;,&quot;value&quot;:true}"></astro-island> </div> </header> </div> <div class="col-start-1 min-w-0"> <article id="markdown-wrapper" class="markdown">  <figure><img src="/image/pasted-image-20250821195011.webp" alt="Pasted image 20250821195011.png" loading="lazy"></figure>
<h2 id="anubis" class="heading">Anubis<a href="#anubis" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h2>
<p>Anubis是一个网站防护工具，其工作原理类似常见的Cloudflare验证，会在用户进入网站之前对客户端进行检查。客户端需要完成一定难度的Hash计算，服务器验证计算结果后放行，Hash计算代表了客户端可能需要执行几千几万次的计算，而服务器验证只需执行一次，对服务器开销小。
当有网络爬虫、CC攻击想进入源站时，需要在攻击者的客户端（比如无头浏览器中）进行一定量的Hash计算，攻击者一般会在一台物理机中运行多个配置了代理的无头浏览器，这些Hash计算会拖垮攻击者的服务器，从而迫使攻击者放弃或降低攻击频率。
现代设备通常都具有一定的算力，这些任务对于这些客户端来说，通常只需要几毫秒或几秒钟即可完成，用户只需要等待一段时间，不需要进行任何操作，成功后会自动进入实际后端服务。</p>
<h2 id="工作原理" class="heading">工作原理<a href="#工作原理" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h2>
<h3 id="hash计算" class="heading">Hash计算<a href="#hash计算" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h3>
<p>和经典的比特币挖矿一致，客户端需要使用一个确定的字符串加上任意数字，进行 <code>sha256</code> 计算，得到的 64 位hash值的前x个数为 0，x就是difficulty</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="js" title="复制 js 代码">js</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> hash</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> sha256</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">`${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">challenge</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">}${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">nonce</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">}`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span></code></pre></div>
<h3 id="整体流程" class="heading">整体流程<a href="#整体流程" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h3>
<figure><img src="/image/pasted-image-20250821205648.webp" alt="Pasted image 20250821205648.png" loading="lazy"></figure>
<p><img src="/image/pasted-image-20250821205632.webp" alt="Pasted image 20250821205632.png" loading="lazy"> 客户端第一次访问时，会根据访问者的IP、ASN、User-Agent，服务器的工作负载，计算出一个数值 <code>weight</code>，之后通过 <code>weight</code> 匹配不同难度的Hash计算任务给客户端。客户端完成计算后，由服务器进行验证，成功之后放行到真正的后端服务，同时返回 <code>Set-Cookies</code> 以保存一段时间验证结果，当用户下次访问时，可复用上次的验证结果。</p>
<h3 id="与nginx搭配" class="heading">与NGINX搭配<a href="#与nginx搭配" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h3>
<figure><img src="/image/pasted-image-20250821210211.webp" alt="Pasted image 20250821210211.png" loading="lazy"></figure>
<p>流量从 80/443 端口进入之后，先交给Anubis进行拦截，验证完成之后再交还回NGINX进行后续流程。在单个服务器内通过unix socket进行交互。</p>
<h2 id="安装配置" class="heading">安装/配置<a href="#安装配置" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h2>
<p>此处以Debian 12 系统为例</p>
<h3 id="安装anubis" class="heading">安装Anubis<a href="#安装anubis" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h3>
<h4 id="下载并安装" class="heading">下载并安装<a href="#下载并安装" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<p>请在<a href="https://github.com/TecharoHQ/anubis/releases" rel="noopener noreferrer" target="_blank">Github</a><i class="iconfont icon-external-link"></i>获取最新的版本号</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="sh" title="复制 sh 代码">sh</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /tmp/anubis.deb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> https://github.com/TecharoHQ/anubis/releases/download/v1.21.3/anubis_1.21.3_amd64.deb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> &#x26;&#x26; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /tmp/anubis.deb</span></span></code></pre></div>
<p>不能直连Github，可以使用加速域名，或者手动下载上传到服务器</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="sh" title="复制 sh 代码">sh</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> -O</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /tmp/anubis.deb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> https://ghfast.top/https://github.com/TecharoHQ/anubis/releases/download/v1.21.3/anubis_1.21.3_amd64.deb</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> &#x26;&#x26; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /tmp/anubis.deb</span></span></code></pre></div>
<p>修改 <code>/etc/anubis/default.env</code>，内容如下</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="txt" title="复制 txt 代码">txt</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span>BIND=/run/anubis/instance.sock</span></span>
<span class="line"><span>BIND_NETWORK=unix</span></span>
<span class="line"><span>SOCKET_MODE=0666</span></span>
<span class="line"><span>TARGET=unix:///run/nginx/nginx.sock</span></span></code></pre></div>
<p>复制默认策略文件，暂不修改</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="sh" title="复制 sh 代码">sh</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /usr/share/doc/anubis/botPolicies.yaml</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /etc/anubis/botPolicies.yaml</span></span></code></pre></div>
<h4 id="systemd运行" class="heading">systemd运行<a href="#systemd运行" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<p>创建service文件</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="sh" title="复制 sh 代码">sh</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">vi</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /etc/systemd/system/anubis.service</span></span></code></pre></div>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="service" title="复制 service 代码">service</button><pre><code class="language-service">[Unit]
Description=Anubis Bot Protection
After=network.target

[Service]
EnvironmentFile=/etc/anubis/default.env
ExecStart=/usr/bin/anubis \
  -bind /run/anubis/instance.sock \
  -bind-network unix \
  -socket-mode 0666 \
  -target unix:///run/nginx/nginx.sock \
  -metrics-bind 127.0.0.1:9091 \
  -metrics-bind-network tcp \
  -policy-fname /etc/anubis/botPolicies.yaml

Restart=always
User=www-data
Group=www-data

[Install]
WantedBy=multi-user.target
</code></pre></div>
<p>创建目录</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="sh" title="复制 sh 代码">sh</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">mkdir</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> -p</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /run/anubis</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /run/nginx</span></span></code></pre></div>
<p>修改权限</p>
<p>此处的用户和NGINX相同</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="sh" title="复制 sh 代码">sh</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">chown</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> www-data:www-data</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /run/anubis</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> /run/nginx</span></span></code></pre></div>
<p>启用Anubis</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="sh" title="复制 sh 代码">sh</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> enable</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> --now</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> anubis.service</span></span></code></pre></div>
<p>确保已经成功运行</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="sh" title="复制 sh 代码">sh</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">systemctl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> status</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF"> anubis</span></span></code></pre></div>
<h3 id="配置nginx" class="heading">配置NGINX<a href="#配置nginx" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h3>
<p>此处提供一份可用NGINX，请自行修改扩展</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="nginx" title="复制 nginx 代码">nginx</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">user </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> root;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">worker_processes </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">auto;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">pid </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">/run/nginx.pid;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">events</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    worker_connections </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">1024</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">http</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    upstream</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> anubis </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> unix:/run/anubis/instance.sock;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        listen </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">443</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> ssl http2;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">uptime.vio.vin;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        ssl_certificate </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    /etc/ssl/violet/certs/all.vio.vin.cert.pem;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        ssl_certificate_key </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">/etc/ssl/violet/certs/all.vio.vin.key.pem;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Host $host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">http://anubis;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">    server</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        listen </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">unix:/run/nginx/nginx.sock;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        server_name </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">uptime.vio.vin;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">        location</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> / </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            proxy_pass </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">http://10.115.15.178:3001;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">Host $host;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">            proxy_set_header </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">X-Real-IP $remote_addr;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre></div>
<ul>
<li>upstream：定义上游服务器为anubis</li>
<li>第一个server：监听 443 入站连接，传输给anubis，传输客户端IP用于IP相关策略判断</li>
<li>第二个server：anubis验证通过之后，实际反向代理的位置</li>
</ul>
<p>至此，基础配置已完成，默认情况下低风险客户端难度为 2，高风险为 4</p>
<h2 id="bot策略" class="heading">Bot策略<a href="#bot策略" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h2>
<p>官网文档：<a href="https://anubis.techaro.lol/docs/admin/policies" rel="noopener noreferrer" target="_blank">https://anubis.techaro.lol/docs/admin/policies</a><i class="iconfont icon-external-link"></i>
需要调整 <code>botPolicies.yaml</code> 文件
默认的<code>botPolicies.yaml</code> 配置文件：<a href="https://github.com/TecharoHQ/anubis/blob/main/data/botPolicies.yaml" rel="noopener noreferrer" target="_blank">https://github.com/TecharoHQ/anubis/blob/main/data/botPolicies.yaml</a><i class="iconfont icon-external-link"></i></p>
<p>bots中定义了多个规则，可以看到已经通过import导入了一部分规则，这部分的文件可以在 <code>/usr/share/doc/anubis/data/bots</code> 中找到</p>
<p>默认的规则如下，可以仿照这些规则写自己的规则</p>
<h3 id="可配置匹配规则" class="heading">可配置匹配规则<a href="#可配置匹配规则" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h3>
<h4 id="匹配请求头" class="heading">匹配请求头<a href="#匹配请求头" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<p><code>/usr/share/doc/anubis/data/bots/cloudflare-workers.yaml</code></p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="yaml" title="复制 yaml 代码">yaml</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">cloudflare-workers</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  headers_regex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    CF-Worker</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">.*</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">WEIGH</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    adjust</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">15</span></span></code></pre></div>
<h4 id="匹配user-agent" class="heading">匹配User-Agent<a href="#匹配user-agent" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<p><code>/usr/share/doc/anubis/data/bots/headless-browsers.yaml</code></p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="yaml" title="复制 yaml 代码">yaml</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">lightpanda</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  user_agent_regex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">^LightPanda/.*$</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">DENY</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">headless-chrome</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  user_agent_regex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">HeadlessChrome</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">DENY</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">headless-chromium</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  user_agent_regex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">HeadlessChromium</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">DENY</span></span></code></pre></div>
<h4 id="指定表达式" class="heading">指定表达式<a href="#指定表达式" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<p><code>/usr/share/doc/anubis/data/bots/aggressive-brazilian-scrapers.yaml</code></p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="yaml" title="复制 yaml 代码">yaml</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">deny-aggressive-brazilian-scrapers</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">WEIGH</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    adjust</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  expression</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    any</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # Internet Explorer should be out of support</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("MSIE")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # Trident is the Internet Explorer browser engine</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("Trident")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # Opera is a fork of chrome now</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("Presto")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # Windows CE is discontinued</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("Windows CE")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # Windows 95 is discontinued</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("Windows 95")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # Windows 98 is discontinued</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("Windows 98")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # Windows 9.x is discontinued</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("Win 9x")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # Amazon does not have an Alexa Toolbar.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("Alexa Toolbar")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # This is not released, even Windows 11 calls itself Windows 10</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("Windows NT 11.0")</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">      # iPods are not in common use</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">userAgent.contains("iPod")</span></span>
<span class="line"></span></code></pre></div>
<h4 id="匹配客户端ip" class="heading">匹配客户端IP<a href="#匹配客户端ip" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<p><code>/usr/share/doc/anubis/data/clients/mistral-mistralai-user.yaml</code></p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="yaml" title="复制 yaml 代码">yaml</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"># Acts on behalf of user requests</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"># https://docs.mistral.ai/robots/</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">mistral-mistralai-user</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  user_agent_regex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">MistralAI-User/.+; \+https\://docs\.mistral\.ai/robots</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">ALLOW</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  # https://mistral.ai/mistralai-user-ips.json</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  remote_addresses</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: [</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">    "20.240.160.161/32"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">    "20.240.160.1/32"</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  ]</span></span></code></pre></div>
<h4 id="匹配geoip" class="heading">匹配GEOIP<a href="#匹配geoip" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="yaml" title="复制 yaml 代码">yaml</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">countries-with-aggressive-scrapers</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">WEIGH</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  geoip</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    countries</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">BR</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">CN</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    adjust</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">10</span></span></code></pre></div>
<h4 id="匹配asn" class="heading">匹配ASN<a href="#匹配asn" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="yaml" title="复制 yaml 代码">yaml</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">aggressive-asns-without-functional-abuse-contact</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">WEIGH</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  asns</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">13335</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> # Cloudflare</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">136907</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> # Huawei Cloud</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">45102</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> # Alibaba Cloud</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    adjust</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">10</span></span></code></pre></div>
<h3 id="匹配后动作" class="heading">匹配后动作<a href="#匹配后动作" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h3>
<div class="table-wrapper">
























<table><thead><tr><th>动作</th><th>解释</th></tr></thead><tbody><tr><td>ALLOW</td><td>允许，跳过后续所有检查</td></tr><tr><td>DENY</td><td>拒绝访问</td></tr><tr><td>CHALLENGE</td><td>进行客户端挑战</td></tr><tr><td>WEIGH</td><td>修改请求权重</td></tr></tbody></table></div>
<p>ALLOW和DENY不再解释</p>
<h4 id="challenge" class="heading">CHALLENGE<a href="#challenge" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="yaml" title="复制 yaml 代码">yaml</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">generic-bot-catchall</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  user_agent_regex</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">(?i:bot|crawler)</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">CHALLENGE</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  challenge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    difficulty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">16</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> # impossible</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    report_as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">4</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> # lie to the operator</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">slow</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> # intentionally waste CPU cycles and time</span></span></code></pre></div>
<ul>
<li><code>name</code>：名称，可自定义</li>
<li><code>user_agent_regex</code>：正则表达式匹配User-Agent</li>
<li><code>action</code>：动作，立即进行客户端挑战</li>
<li><code>challenge</code>：客户端挑战配置
<ul>
<li><code>difficulty</code>：难度，16 表示计算出的hash值前 16 位为 0，不可能完成（比特币的前导 0 个数为 19-20），在客户端完成 16 位的计算可能需要几万年甚至更久（攻击者看着 99%的CPU陷入沉思）</li>
<li><code>report_as</code>：用户在界面上看到的难度数值（你甚至可以骗他，这个进度条怎么一直卡在 99%不走呢）</li>
<li><code>algorithm</code>：采用的Hash算法，slow故意折磨CPU</li>
</ul>
</li>
</ul>
<h4 id="weigh" class="heading">WEIGH<a href="#weigh" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h4>
<p>调整请求的权重，正数为增加权重，负数为减少权重，后续会进入到 <code>thresholds</code> 中，针对不同的请求设置不同的CHALLENGE</p>
<p>0-10 的权重，进行快速算法，几乎不需要等待</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="yaml" title="复制 yaml 代码">yaml</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">- </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">mild-suspicion</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  expression</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    all</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">weight > 0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">weight &#x3C; 10</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">CHALLENGE</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">  challenge</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    algorithm</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">metarefresh</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    difficulty</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    report_as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">2</span></span></code></pre></div>
<h3 id="其他" class="heading">其他<a href="#其他" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h3>
<p>根据服务器负载动态调整</p>
<p>示例在配置文件中已给出，有需要可以启用</p>
<div class="code-block"><button class="lang-tag copy-code-btn" data-lang="yaml" title="复制 yaml 代码">yaml</button><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  ## System load based checks.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  # If the system is under high load, add weight.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">high-load-average</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">WEIGH</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    expression</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">load_1m >= 10.0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> # make sure to end the load comparison in a .0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">      adjust</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">20</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  # If your backend service is running on the same operating system as Anubis,</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  # you can uncomment this rule to make the challenge easier when the system is</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  # under low load.</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  #</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">  # If it is not, remove weight.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">name</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">low-load-average</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">WEIGH</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    expression</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF">load_15m &#x3C;= 4.0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> # make sure to end the load comparison in a .0</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">    weight</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">      adjust</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">-10</span></span></code></pre></div>
<h3 id="测试页面" class="heading">测试页面<a href="#测试页面" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h3>
<p>为了方便<del>在大家的浏览器中挖矿</del>方便大家测试，我准备了这些界面
建议用隐私窗口打开，否则会使用上一次的结果</p>
<div class="table-wrapper">












































<table><thead><tr><th>难度</th><th>地址</th></tr></thead><tbody><tr><td>2</td><td><a href="https://pow.vio.vin/challenge/2" rel="noopener noreferrer" target="_blank">https://pow.vio.vin/challenge/2</a><i class="iconfont icon-external-link"></i></td></tr><tr><td>3</td><td><a href="https://pow.vio.vin/challenge/3" rel="noopener noreferrer" target="_blank">https://pow.vio.vin/challenge/3</a><i class="iconfont icon-external-link"></i></td></tr><tr><td>4</td><td><a href="https://pow.vio.vin/challenge/4" rel="noopener noreferrer" target="_blank">https://pow.vio.vin/challenge/4</a><i class="iconfont icon-external-link"></i></td></tr><tr><td>5</td><td><a href="https://pow.vio.vin/challenge/5" rel="noopener noreferrer" target="_blank">https://pow.vio.vin/challenge/5</a><i class="iconfont icon-external-link"></i></td></tr><tr><td>6</td><td><a href="https://pow.vio.vin/challenge/6" rel="noopener noreferrer" target="_blank">https://pow.vio.vin/challenge/6</a><i class="iconfont icon-external-link"></i></td></tr><tr><td>7</td><td><a href="https://pow.vio.vin/challenge/7" rel="noopener noreferrer" target="_blank">https://pow.vio.vin/challenge/7</a><i class="iconfont icon-external-link"></i></td></tr><tr><td>8</td><td><a href="https://pow.vio.vin/challenge/8" rel="noopener noreferrer" target="_blank">https://pow.vio.vin/challenge/8</a><i class="iconfont icon-external-link"></i></td></tr><tr><td>10</td><td><a href="https://pow.vio.vin/challenge/10" rel="noopener noreferrer" target="_blank">https://pow.vio.vin/challenge/10</a><i class="iconfont icon-external-link"></i></td></tr><tr><td>20</td><td><a href="https://pow.vio.vin/challenge/20" rel="noopener noreferrer" target="_blank">https://pow.vio.vin/challenge/20</a><i class="iconfont icon-external-link"></i></td></tr></tbody></table></div>
<h2 id="参加文献" class="heading">参加文献<a href="#参加文献" class="heading-anchor" aria-label="Heading Anchor"><i class="iconfont icon-link"></i></a></h2>
<p><a href="https://lock.cmpxchg8b.com/anubis.html" rel="noopener noreferrer" target="_blank">https://lock.cmpxchg8b.com/anubis.html</a><i class="iconfont icon-external-link"></i></p>  </article> </div> <div class="hidden lg:block" data-pagefind-ignore> <aside class="sticky top-20"> <section> <div class="mb-8 font-bold uppercase tracking-widest text-accent">目录</div>  <astro-island uid="1LOM5m" prefix="r1" component-url="/_astro/PostToc.D0APJ5jp.js" component-export="PostToc" renderer-url="/_astro/client.mqtPdmm5.js" props="{&quot;headings&quot;:[1,[[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;anubis&quot;],&quot;text&quot;:[0,&quot;Anubis&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;工作原理&quot;],&quot;text&quot;:[0,&quot;工作原理&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;hash计算&quot;],&quot;text&quot;:[0,&quot;Hash计算&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;整体流程&quot;],&quot;text&quot;:[0,&quot;整体流程&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;与nginx搭配&quot;],&quot;text&quot;:[0,&quot;与NGINX搭配&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;安装配置&quot;],&quot;text&quot;:[0,&quot;安装/配置&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;安装anubis&quot;],&quot;text&quot;:[0,&quot;安装Anubis&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;下载并安装&quot;],&quot;text&quot;:[0,&quot;下载并安装&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;systemd运行&quot;],&quot;text&quot;:[0,&quot;systemd运行&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;配置nginx&quot;],&quot;text&quot;:[0,&quot;配置NGINX&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;bot策略&quot;],&quot;text&quot;:[0,&quot;Bot策略&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;可配置匹配规则&quot;],&quot;text&quot;:[0,&quot;可配置匹配规则&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;匹配请求头&quot;],&quot;text&quot;:[0,&quot;匹配请求头&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;匹配user-agent&quot;],&quot;text&quot;:[0,&quot;匹配User-Agent&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;指定表达式&quot;],&quot;text&quot;:[0,&quot;指定表达式&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;匹配客户端ip&quot;],&quot;text&quot;:[0,&quot;匹配客户端IP&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;匹配geoip&quot;],&quot;text&quot;:[0,&quot;匹配GEOIP&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;匹配asn&quot;],&quot;text&quot;:[0,&quot;匹配ASN&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;匹配后动作&quot;],&quot;text&quot;:[0,&quot;匹配后动作&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;challenge&quot;],&quot;text&quot;:[0,&quot;CHALLENGE&quot;]}],[0,{&quot;depth&quot;:[0,4],&quot;slug&quot;:[0,&quot;weigh&quot;],&quot;text&quot;:[0,&quot;WEIGH&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;其他&quot;],&quot;text&quot;:[0,&quot;其他&quot;]}],[0,{&quot;depth&quot;:[0,3],&quot;slug&quot;:[0,&quot;测试页面&quot;],&quot;text&quot;:[0,&quot;测试页面&quot;]}],[0,{&quot;depth&quot;:[0,2],&quot;slug&quot;:[0,&quot;参加文献&quot;],&quot;text&quot;:[0,&quot;参加文献&quot;]}]]]}" ssr="" client="idle" opts="{&quot;name&quot;:&quot;PostToc&quot;,&quot;value&quot;:true}" await-children=""><ul class="relative overflow-y-auto space-y-2 group text-sm" style="max-height:min(380px, calc(100vh - 250px));scrollbar-width:none"><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:20px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#anubis"><span>Anubis</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:20px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#工作原理"><span>工作原理</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:16px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#hash计算"><span>Hash计算</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:16px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#整体流程"><span>整体流程</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:16px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#与nginx搭配"><span>与NGINX搭配</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:20px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#安装配置"><span>安装/配置</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:16px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#安装anubis"><span>安装Anubis</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#下载并安装"><span>下载并安装</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#systemd运行"><span>systemd运行</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:16px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#配置nginx"><span>配置NGINX</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:20px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#bot策略"><span>Bot策略</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:16px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#可配置匹配规则"><span>可配置匹配规则</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#匹配请求头"><span>匹配请求头</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#匹配user-agent"><span>匹配User-Agent</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#指定表达式"><span>指定表达式</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#匹配客户端ip"><span>匹配客户端IP</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#匹配geoip"><span>匹配GEOIP</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#匹配asn"><span>匹配ASN</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:16px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#匹配后动作"><span>匹配后动作</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#challenge"><span>CHALLENGE</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:12px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#weigh"><span>WEIGH</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:16px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#其他"><span>其他</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:16px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#测试页面"><span>测试页面</span></a></li><li class="relative"><span class="absolute left-0 top-2 h-1 rounded-full bg-zinc-300 dark:bg-zinc-700" style="width:20px"></span><a class="inline-block pl-8 opacity-0 transition-opacity duration-300 group-hover:opacity-100 text-zinc-500 hover:text-zinc-900 dark:hover:text-zinc-100" href="#参加文献"><span>参加文献</span></a></li></ul><!--astro:end--></astro-island> <hr class="my-2 border-primary max-w-[100px]"> <astro-island uid="1XMHP1" prefix="r2" component-url="/_astro/ReadingProgress.C56RqbCr.js" component-export="ReadingProgress" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="idle" opts="{&quot;name&quot;:&quot;ReadingProgress&quot;,&quot;value&quot;:true}" await-children=""><div><span class="text-sm">进度 <!-- -->0<!-- -->%</span></div><!--astro:end--></astro-island>  </section> <astro-island uid="1TWCj" prefix="r3" component-url="/_astro/ActionAside.C4u2k5xB.js" component-export="ActionAside" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="idle" opts="{&quot;name&quot;:&quot;ActionAside&quot;,&quot;value&quot;:true}" await-children=""><div class="absolute left-0 bottom-0 flex flex-col gap-4" style="transform:translateY(calc(100% + 24px))"><button type="button" aria-label="Share this post" class="size-6 text-xl leading-none hover:text-accent"><i class="iconfont icon-share"></i></button></div><!--astro:end--></astro-island> </aside> </div> <div data-pagefind-ignore> <section class="space-y-6"> <script>(()=>{var l=(s,i,o)=>{let r=async()=>{await(await s())()},t=typeof i.value=="object"?i.value:void 0,c={rootMargin:t==null?void 0:t.rootMargin},n=new IntersectionObserver(e=>{for(let a of e)if(a.isIntersecting){n.disconnect(),r();break}},c);for(let e of o.children)n.observe(e)};(self.Astro||(self.Astro={})).visible=l;window.dispatchEvent(new Event("astro:visible"));})();</script><astro-island uid="13xKIg" prefix="r4" component-url="/_astro/PostCopyright.CFqXmrHl.js" component-export="PostCopyright" renderer-url="/_astro/client.mqtPdmm5.js" props="{&quot;title&quot;:[0,&quot;Anubis网站防护工具配置教程&quot;],&quot;slug&quot;:[0,&quot;/posts/anubis-wang-zhan-fang-hu-gong-ju-pei-zhi-jiao-cheng&quot;],&quot;lastMod&quot;:[3,&quot;2025-10-19T13:47:16.000Z&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;PostCopyright&quot;,&quot;value&quot;:true}" await-children=""><section class="text-xs leading-loose text-secondary"><p>文章标题：<!-- -->Anubis网站防护工具配置教程</p><p>文章作者：<!-- -->violet</p><p><span>文章链接：<!-- -->https://www.vio.vin/posts/anubis-wang-zhan-fang-hu-gong-ju-pei-zhi-jiao-cheng</span><span role="button" class="cursor-pointer select-none">[复制]</span></p><p>最后修改时间：</p><hr class="my-3 border-primary"/><div><p>商业转载请联系站长获得授权，非商业转载请注明本文出处及文章链接，您可以自由地在任何媒体以任何形式复制和分发作品，也可以修改和创作，但是分发衍生作品时必须采用相同的许可协议。<br/>本文采用<a class="hover:underline hover:text-accent underline-offset-2" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener noreferrer">CC BY-NC-SA 4.0</a>进行许可。</p></div></section><!--astro:end--></astro-island> <div class="grid grid-cols-2"> <div> <a class="flex items-baseline gap-2 hover:text-accent" href="/posts/dian-zi-you-jian-an-quan-zhi-pgp-jia-mi"> <i class="iconfont icon-arrow-left"></i> <span>电子邮件安全之PGP加密</span> </a> </div> <div> <a class="flex items-baseline justify-end gap-2 hover:text-accent" href="/posts/wo-de-blog-gou-jian-guo-cheng"> <span>我的Blog构建过程</span> <i class="iconfont icon-arrow-right"></i> </a> </div> </div> <div> <astro-island uid="Z11zv83" prefix="r8" component-url="/_astro/Giscus.PEIo40rl.js" component-export="Giscus" renderer-url="/_astro/client.mqtPdmm5.js" props="{&quot;repo&quot;:[0,&quot;xkdvSrPD/astro-gyoza&quot;],&quot;repoId&quot;:[0,&quot;R_kgDOPW4tbw&quot;],&quot;category&quot;:[0,&quot;Announcements&quot;],&quot;categoryId&quot;:[0,&quot;DIC_kwDOPW4tb84Ctvvm&quot;],&quot;mapping&quot;:[0,&quot;title&quot;],&quot;strict&quot;:[0,&quot;0&quot;],&quot;reactionsEnabled&quot;:[0,&quot;1&quot;],&quot;emitMetadata&quot;:[0,&quot;0&quot;],&quot;inputPosition&quot;:[0,&quot;top&quot;],&quot;theme&quot;:[0,&quot;preferred_color_scheme&quot;],&quot;lang&quot;:[0,&quot;zh-CN&quot;],&quot;loading&quot;:[0,&quot;lazy&quot;]}" ssr="" client="visible" opts="{&quot;name&quot;:&quot;Giscus&quot;,&quot;value&quot;:true}" await-children=""><div class="giscus-container"></div><!--astro:end--></astro-island> <script>(function(){const giscusConfig = {"repo":"xkdvSrPD/astro-gyoza","repoId":"R_kgDOPW4tbw","category":"Announcements","categoryId":"DIC_kwDOPW4tb84Ctvvm","mapping":"title","strict":"0","reactionsEnabled":"1","emitMetadata":"0","inputPosition":"top","theme":"preferred_color_scheme","lang":"zh-CN","loading":"lazy"};

    console.log('Comments Debug:', {
      hasGiscusRepo: !!giscusConfig.repo,
      giscusConfig: giscusConfig,
      currentHostname: window.location.hostname,
      shouldShowComments: !window.location.hostname.includes('vio.vin')
    });
  })();</script> </div> </section> </div> </div>  </div> </main> <footer class="relative z-1 py-8 px-4 md:px-8 border-t border-primary text-secondary text-sm"> <div class="text-center space-y-2"> <div>
Powered by
<a class="hover:text-accent" href="https://astro.build/" target="_blank" rel="noopener noreferrer">Astro</a>
& Designed by
<a class="hover:text-accent" href="https://github.com/lxchapu/astro-gyoza" target="_blank" rel="noopener noreferrer">Gyoza</a> </div> <div class="space-x-1"> <span>&copy;2025 <a class="hover:text-accent" href="/">violet</a>.</span> <a class="hover:text-accent" href="/rss.xml" data-no-swup> <i class="iconfont icon-rss"></i> <span>RSS</span> </a> <a class="hover:text-accent" href="/sitemap-index.xml" data-no-swup> <i class="iconfont icon-map"></i> <span>站点地图</span> </a> </div> <div id="beian-info" style="display: none;"> <a class="hover:text-accent" href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer">陕ICP备2021015553号-2</a> </div> <div> <astro-island uid="2lyoQd" component-url="/_astro/RunningDays.BwCVpTPm.js" component-export="RunningDays" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;RunningDays&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <span class="select-none opacity-50">|</span> <span>共嘚嘚了 23.3k 字</span> </div> </div> <div class="mt-4 flex justify-center"> <astro-island uid="2rkdGA" component-url="/_astro/ThemeSwitch.DIr4sTZG.js" component-export="ThemeSwitch" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;ThemeSwitch&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> </div> </footer>   <astro-island uid="Z249zDI" component-url="/_astro/BackToTopFAB.SyKIbegK.js" component-export="BackToTopFAB" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;BackToTopFAB&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <astro-island uid="Z1PI9bJ" component-url="/_astro/ToastContainer.CTUZj64J.js" component-export="ToastContainer" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;ToastContainer&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <astro-island uid="vaeF1" component-url="/_astro/ToastHandler.DqOp202O.js" component-export="ToastHandler" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;ToastHandler&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> <astro-island uid="Z1bh22V" component-url="/_astro/modal.Dr-gj-5h.js" component-export="ModalStack" renderer-url="/_astro/client.mqtPdmm5.js" props="{}" ssr="" client="only" opts="{&quot;name&quot;:&quot;ModalStack&quot;,&quot;value&quot;:&quot;react&quot;}"></astro-island> </body></html>