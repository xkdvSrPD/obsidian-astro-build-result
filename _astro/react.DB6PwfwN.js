import{e as ne,r as D}from"./index.CMQ3OGCn.js";const L={},Z=(e,n)=>e.unstable_is?e.unstable_is(n):n===e,k=e=>"init"in e,C=e=>!!e.write,B=e=>"v"in e||"e"in e,x=e=>{if("e"in e)throw e.e;if((L?"production":void 0)!=="production"&&!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},j=new WeakMap,H=e=>{var n;return M(e)&&!!((n=j.get(e))!=null&&n[0])},le=e=>{const n=j.get(e);n?.[0]&&(n[0]=!1,n[1].forEach(r=>r()))},re=(e,n)=>{let r=j.get(e);if(!r){r=[!0,new Set],j.set(e,r);const o=()=>{r[0]=!1};e.then(o,o)}r[1].add(n)},M=e=>typeof e?.then=="function",oe=(e,n,r)=>{r.p.has(e)||(r.p.add(e),n.then(()=>{r.p.delete(e)},()=>{r.p.delete(e)}))},G=(e,n,r)=>{const o=r(e),u="v"in o,f=o.v;if(M(n))for(const a of o.d.keys())oe(e,n,r(a));o.v=n,delete o.e,(!u||!Object.is(f,o.v))&&(++o.n,M(f)&&le(f))},m=(e,n,r)=>{var o;const u=new Set;for(const f of((o=r.get(e))==null?void 0:o.t)||[])r.has(f)&&u.add(f);for(const f of n.p)u.add(f);return u},ue=()=>{const e=new Set,n=()=>{e.forEach(r=>r())};return n.add=r=>(e.add(r),()=>{e.delete(r)}),n},K=()=>{const e={},n=new WeakMap,r=o=>{var u,f;(u=n.get(e))==null||u.forEach(a=>a(o)),(f=n.get(o))==null||f.forEach(a=>a())};return r.add=(o,u)=>{const f=o||e,a=(n.has(f)?n:n.set(f,new Set)).get(f);return a.add(u),()=>{a?.delete(u),a.size||n.delete(f)}},r},de=e=>(e.c||(e.c=K()),e.m||(e.m=K()),e.u||(e.u=K()),e.f||(e.f=ue()),e),fe=Symbol(),ae=(e=new WeakMap,n=new WeakMap,r=new WeakMap,o=new Set,u=new Set,f=new Set,a={},S=(h,...b)=>h.read(...b),g=(h,...b)=>h.write(...b),v=(h,b)=>{var A;return(A=h.unstable_onInit)==null?void 0:A.call(h,b)},_=(h,b)=>{var A;return(A=h.onMount)==null?void 0:A.call(h,b)},...y)=>{const h=y[0]||(t=>{if((L?"production":void 0)!=="production"&&!t)throw new Error("Atom is undefined or null");let d=e.get(t);return d||(d={d:new Map,p:new Set,n:0},e.set(t,d),v?.(t,J)),d}),b=y[1]||(()=>{const t=[],d=l=>{try{l()}catch(s){t.push(s)}};do{a.f&&d(a.f);const l=new Set,s=l.add.bind(l);o.forEach(i=>{var c;return(c=n.get(i))==null?void 0:c.l.forEach(s)}),o.clear(),f.forEach(s),f.clear(),u.forEach(s),u.clear(),l.forEach(d),o.size&&A()}while(o.size||f.size||u.size);if(t.length)throw new AggregateError(t)}),A=y[2]||(()=>{const t=[],d=new WeakSet,l=new WeakSet,s=Array.from(o);for(;s.length;){const i=s[s.length-1],c=h(i);if(l.has(i)){s.pop();continue}if(d.has(i)){if(r.get(i)===c.n)t.push([i,c]);else if((L?"production":void 0)!=="production"&&r.has(i))throw new Error("[Bug] invalidated atom exists");l.add(i),s.pop();continue}d.add(i);for(const p of m(i,c,n))d.has(p)||s.push(p)}for(let i=t.length-1;i>=0;--i){const[c,p]=t[i];let E=!1;for(const T of p.d.keys())if(T!==c&&o.has(T)){E=!0;break}E&&(P(c),W(c)),r.delete(c)}}),P=y[3]||(t=>{var d;const l=h(t);if(B(l)&&(n.has(t)&&r.get(t)!==l.n||Array.from(l.d).every(([w,V])=>P(w).n===V)))return l;l.d.clear();let s=!0;const i=()=>{n.has(t)&&(W(t),A(),b())},c=w=>{var V;if(Z(t,w)){const Y=h(w);if(!B(Y))if(k(w))G(w,w.init,h);else throw new Error("no atom init");return x(Y)}const $=P(w);try{return x($)}finally{l.d.set(w,$.n),H(l.v)&&oe(t,l.v,$),(V=n.get(w))==null||V.t.add(t),s||i()}};let p,E;const T={get signal(){return p||(p=new AbortController),p.signal},get setSelf(){return(L?"production":void 0)!=="production"&&!C(t)&&console.warn("setSelf function cannot be used with read-only atom"),!E&&C(t)&&(E=(...w)=>{if((L?"production":void 0)!=="production"&&s&&console.warn("setSelf function cannot be called in sync"),!s)try{return R(t,...w)}finally{A(),b()}}),E}},N=l.n;try{const w=S(t,c,T);return G(t,w,h),M(w)&&(re(w,()=>p?.abort()),w.then(i,i)),l}catch(w){return delete l.v,l.e=w,++l.n,l}finally{s=!1,N!==l.n&&r.get(t)===N&&(r.set(t,l.n),o.add(t),(d=a.c)==null||d.call(a,t))}}),U=y[4]||(t=>{const d=[t];for(;d.length;){const l=d.pop(),s=h(l);for(const i of m(l,s,n)){const c=h(i);r.set(i,c.n),d.push(i)}}}),R=y[5]||((t,...d)=>{let l=!0;const s=c=>x(P(c)),i=(c,...p)=>{var E;const T=h(c);try{if(Z(t,c)){if(!k(c))throw new Error("atom not writable");const N=T.n,w=p[0];G(c,w,h),W(c),N!==T.n&&(o.add(c),(E=a.c)==null||E.call(a,c),U(c));return}else return R(c,...p)}finally{l||(A(),b())}};try{return g(t,s,i,...d)}finally{l=!1}}),W=y[6]||(t=>{var d;const l=h(t),s=n.get(t);if(s&&!H(l.v)){for(const[i,c]of l.d)if(!s.d.has(i)){const p=h(i);z(i).t.add(t),s.d.add(i),c!==p.n&&(o.add(i),(d=a.c)==null||d.call(a,i),U(i))}for(const i of s.d||[])if(!l.d.has(i)){s.d.delete(i);const c=O(i);c?.t.delete(t)}}}),z=y[7]||(t=>{var d;const l=h(t);let s=n.get(t);if(!s){P(t);for(const i of l.d.keys())z(i).t.add(t);if(s={l:new Set,d:new Set(l.d.keys()),t:new Set},n.set(t,s),(d=a.m)==null||d.call(a,t),C(t)){const i=()=>{let c=!0;const p=(...E)=>{try{return R(t,...E)}finally{c||(A(),b())}};try{const E=_(t,p);E&&(s.u=()=>{c=!0;try{E()}finally{c=!1}})}finally{c=!1}};u.add(i)}}return s}),O=y[8]||(t=>{var d;const l=h(t);let s=n.get(t);if(s&&!s.l.size&&!Array.from(s.t).some(i=>{var c;return(c=n.get(i))==null?void 0:c.d.has(t)})){s.u&&f.add(s.u),s=void 0,n.delete(t),(d=a.u)==null||d.call(a,t);for(const i of l.d.keys()){const c=O(i);c?.t.delete(t)}return}return s}),ce=[e,n,r,o,u,f,a,S,g,v,_,h,b,A,P,U,R,W,z,O],J={get:t=>x(P(t)),set:(t,...d)=>{try{return R(t,...d)}finally{A(),b()}},sub:(t,d)=>{const s=z(t).l;return s.add(d),b(),()=>{s.delete(d),O(t),b()}}};return Object.defineProperty(J,fe,{value:ce}),J},ie=ae,ve=de,ee=re,X={};let he=0;function De(e,n){const r=`atom${++he}`,o={toString(){return(X?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof e=="function"?o.read=e:(o.init=e,o.read=_e,o.write=we),o}function _e(e){return e(this)}function we(e,n,r){return n(this,typeof r=="function"?r(e(this)):r)}const Se=()=>{let e=0;const n=ve({}),r=new WeakMap,o=new WeakMap,u=ie(r,o,void 0,void 0,void 0,void 0,n,void 0,(S,g,v,..._)=>e?v(S,..._):S.write(g,v,..._)),f=new Set;return n.m.add(void 0,S=>{f.add(S);const g=r.get(S);g.m=o.get(S)}),n.u.add(void 0,S=>{f.delete(S);const g=r.get(S);delete g.m}),Object.assign(u,{dev4_get_internal_weak_map:()=>(console.log("Deprecated: Use devstore from the devtools library"),r),dev4_get_mounted_atoms:()=>f,dev4_restore_atoms:S=>{const g={read:()=>null,write:(v,_)=>{++e;try{for(const[y,h]of S)"init"in y&&_(y,h)}finally{--e}}};u.set(g)}})};function ye(){return(X?"production":void 0)!=="production"?Se():ie()}let I;function ge(){return I||(I=ye(),(X?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=I),globalThis.__JOTAI_DEFAULT_STORE__!==I&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),I}const pe={},be=D.createContext(void 0);function se(e){return D.useContext(be)||ge()}const F=e=>typeof e?.then=="function",Q=e=>{e.status||(e.status="pending",e.then(n=>{e.status="fulfilled",e.value=n},n=>{e.status="rejected",e.reason=n}))},Ee=ne.use||(e=>{if(e.status==="pending")throw e;if(e.status==="fulfilled")return e.value;throw e.status==="rejected"?e.reason:(Q(e),e)}),q=new WeakMap,te=(e,n)=>{let r=q.get(e);return r||(r=new Promise((o,u)=>{let f=e;const a=v=>_=>{f===v&&o(_)},S=v=>_=>{f===v&&u(_)},g=()=>{try{const v=n();F(v)?(q.set(v,r),f=v,v.then(a(v),S(v)),ee(v,g)):o(v)}catch(v){u(v)}};e.then(a(e),S(e)),ee(e,g)}),q.set(e,r)),r};function Ae(e,n){const{delay:r,unstable_promiseStatus:o=!ne.use}={},u=se(),[[f,a,S],g]=D.useReducer(_=>{const y=u.get(e);return Object.is(_[0],y)&&_[1]===u&&_[2]===e?_:[y,u,e]},void 0,()=>[u.get(e),u,e]);let v=f;if((a!==u||S!==e)&&(g(),v=u.get(e)),D.useEffect(()=>{const _=u.sub(e,()=>{if(o)try{const y=u.get(e);F(y)&&Q(te(y,()=>u.get(e)))}catch{}if(typeof r=="number"){setTimeout(g,r);return}g()});return g(),_},[u,e,r,o]),D.useDebugValue(v),F(v)){const _=te(v,()=>u.get(e));return o&&Q(_),Ee(_)}return v}function Pe(e,n){const r=se();return D.useCallback((...u)=>{if((pe?"production":void 0)!=="production"&&!("write"in e))throw new Error("not writable atom");return r.set(e,...u)},[r,e])}function Re(e,n){return[Ae(e),Pe(e)]}export{Pe as a,De as b,Re as c,Ae as u};
